<html>
<head>
    <title>CSS Heat Map</title>
</head>
<style>
   .tooltip,body{background:#000;color:#fff}text{font-size:11px;pointer-events:none}text.parent{fill:#FFF;font-size:14px}circle{fill:#ccc;stroke:#fff;pointer-events:all;font-size:20px}circle.duplicate{fill:purple}circle.red{fill:red}circle.orangeRed{fill:#ff4500}circle.orange{fill:orange}circle.parent{fill:#b2bfc9;fill-opacity:.1;stroke:#fff}.tooltip{font-family:Arial;font-size:10px;padding:10px;width:100px;height:20px;border:1px solid #fff;position:absolute;top:0;left:200px;visibility:hidden}.legend,.pageTitle{position:absolute;padding-left:20px}circle.parent:hover{stroke:#ff7f0e;stroke-width:.5px}circle.child{pointer-events:none}.legend{width:300px;left:20px;top:70%;height:500px}.colorCode{width:14px;height:14px;border-radius:7px;display:inline-block}.colorCode.red{background:red}.colorCode.orange{background:orange}.colorCode.orangeRed{background:#ff4500}.colorCode.purple{background:purple}.pageTitle{top:0;left:0;width:100%;height:20px;color:#fff;font-size:20px;text-align:center}
</style>
<body>
    <div class="pageTitle">CSS Heat Map</div>
    <div id="heatMapContainer" style="display: none">GENERATE CSS HEAT MAP FIRST</div>
    <div class="legend"><div>Legend</div><div> <span class="colorCode red"> </span> <span> References > 10 (Sensitive CSS Rule) </span></div><div> <span class="colorCode orangeRed"> </span> <span> References > 5 (Most Used Rule) </span></div><div> <span class="colorCode orange"> </span> <span> References > 1 (Fairly Used Rule) </span></div><div> <span class="colorCode purple"> </span> <span> Duplicate Rule (Should be avoided)</span></div></div>
    <div class="tooltip"></div>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
    <script src="./cssHeatMapData.js"></script>
    <script>
        var heatMapDataTransformedToFlare={name:"CSSHeatMap",children:[]},globalCSSHeatMapData=null,transformToFlare=function(t){globalCSSHeatMapData=t,Object.keys(t).forEach(function(e){var r={name:e.slice(e.lastIndexOf("/")),children:[]};t[e].forEach(function(t,n){r.children.push({fileName:e,ruleIdx:n,name:t.rule,size:t.sensitivity,isDuplicate:t.isDuplicate})}),heatMapDataTransformedToFlare.children.push(r)})};$(document).ready(function(){heatMapData?transformToFlare(heatMapData):$("#heatMapContainer").show()});var node,root,w=1280,h=700,r=600,x=d3.scale.linear().range([0,r]),y=d3.scale.linear().range([0,r]),pack=d3.layout.pack().size([r,r]).value(function(t){return t.size}),vis=d3.select("body").insert("svg:svg","h2").attr("width",w).attr("height",h).append("svg:g").attr("transform","translate("+(w-r)/2+","+(h-r)/2+")");function zoom(t,e){var n=r/t.r/2;x.domain([t.x-t.r,t.x+t.r]),y.domain([t.y-t.r,t.y+t.r]);var a=vis.transition().duration(d3.event.altKey?7500:750);a.selectAll("circle").attr("cx",function(t){return x(t.x)}).attr("cy",function(t){return y(t.y)}).attr("r",function(t){return n*t.r}),a.selectAll("text").attr("x",function(t){return x(t.x)}).attr("y",function(t){return t.children?y(t.y)-10:y(t.y)}).style("opacity",function(t){return n*t.r>20?1:0}),node=t,d3.event.stopPropagation()}setTimeout(function(){node=root=heatMapDataTransformedToFlare;var t=pack.nodes(root);vis.selectAll("circle").data(t).enter().append("svg:circle").attr("class",function(t){return t.children?"parent":t.isDuplicate?"duplicate":t.size<5?"orange":t.size<10?"orangeRed":"red"}).attr("cx",function(t){return t.x}).attr("id",function(t){return t.fileName+"$SEPERATOR$"+t.ruleIdx}).attr("cy",function(t){return t.y}).attr("r",function(t){return t.r}).on("click",function(t){return zoom(node==t?root:t)});var e="",r=d3.select(".tooltip").text(function(t){return e});vis.selectAll("circle").on("mousemove",function(t){var n=d3.select(this).attr("id");"undefined$SEPERATOR$undefined"!==n&&(e="Usage Count: "+globalCSSHeatMapData[n.split("$SEPERATOR$")[0]][n.split("$SEPERATOR$")[1]].sensitivity,r.html(e).style("visibility","visible").style("top",d3.event.pageY+10+"px").style("left",d3.event.pageX+10+"px"))}).on("mouseout",function(){return r.style("visibility","hidden")}),vis.selectAll("text").data(t).enter().append("svg:text").attr("class",function(t){return t.children?"parent":"child"}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("dy",".35em").attr("text-anchor","middle").style("opacity",function(t){return t.r>20?1:0}).text(function(t){return t.name}),d3.select(window).on("click",function(){zoom(root)})},3e3);
    </script>
</body>
</html>